!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ArrQL={})}(this,(function(e){"use strict";function t(e){e&&(this.table=e)}t.prototype.select=function(...e){return this.selector=t=>e.reduce(((e,r)=>(e[r.name]=r(t),e)),{}),this},t.prototype.from=function(e){return this.table=e,this},t.prototype.where=function(e){return this.predicate=e,this},t.prototype.groupBy=function(...e){return this.groupKeys=(e=>t=>e.map((e=>({_name:e.name,key:e(t)}))))(e),this.grouping=(e,t)=>{const r=this.groupKeys(t);let n=e,o=0;for(;o<r.length-1;){const{key:e}=r[o];n[e]||(n[e]={}),n=n[e],o++}return n[r[o].key]||(n[r[o].key]=[]),n[r[o].key].push(t),e},this},t.prototype.exec=function(){const e=this.selector||(e=>e),t=this.predicate||(e=>!0),r=this.table.filter(t);if(this.grouping){const t=this.groupKeys(this.table[0]).map((({_name:e})=>e));return((e,t)=>{const r=[],n=(e,[t,...o],s)=>{Array.isArray(e)?r.push({...s,_values:e}):Object.keys(e).forEach((r=>{n(e[r],o,{...s,[t]:r})}))};return n(e,t,{}),r})(r.reduce(this.grouping,{}),t).map(e)}return r.map(e)};e.Query=t,e.and=(...e)=>t=>e.reduce(((e,r)=>e&&r(t)),!0),e.avg=e=>{const t=`avg(${e.name})`;return{[t]({_values:t}){let r=0,n=0;return t.forEach(((t,o)=>{r+=e(p),n=r/(o+1)})),n}}[t]},e.equal=(e,t)=>r=>e(r)===t,e.gt=(e,t)=>r=>e(r)>t,e.gte=(e,t)=>r=>e(r)>=t,e.like=(e,t)=>r=>{if("string"==typeof t)return e(r).includes(t)},e.lt=(e,t)=>r=>e(r)<t,e.lte=(e,t)=>r=>e(r)<=t,e.or=(...e)=>t=>e.reduce(((e,r)=>e||r(t)),!1),e.select=(...e)=>(new t).select(...e),e.sum=e=>{const t=`sum(${e.name})`;return{[t]:({_values:t})=>t.reduce(((t,r)=>t+e(r)),0)}[t]},Object.defineProperty(e,"__esModule",{value:!0})}));
